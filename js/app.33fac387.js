(function(t){function e(e){for(var a,n,r=e[0],l=e[1],h=e[2],d=0,_=[];d<r.length;d++)n=r[d],Object.prototype.hasOwnProperty.call(i,n)&&i[n]&&_.push(i[n][0]),i[n]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(t[a]=l[a]);c&&c(e);while(_.length)_.shift()();return o.push.apply(o,h||[]),s()}function s(){for(var t,e=0;e<o.length;e++){for(var s=o[e],a=!0,r=1;r<s.length;r++){var l=s[r];0!==i[l]&&(a=!1)}a&&(o.splice(e--,1),t=n(n.s=s[0]))}return t}var a={},i={app:0},o=[];function n(e){if(a[e])return a[e].exports;var s=a[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=a,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(s,a,function(e){return t[e]}.bind(null,a));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=e,r=r.slice();for(var h=0;h<r.length;h++)e(r[h]);var c=l;o.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},"0e4f":function(t,e,s){"use strict";s("c112")},"4c9d":function(t,e,s){"use strict";s("6941")},"56d7":function(t,e,s){"use strict";s.r(e);var a=s("5923"),i=function(){var t=this,e=t._self._c;return e("div",[e("div",{class:["content-container",t.sidebar_shown_on_pc_mode?"":"side-hidden-screen"]},[e("ContentView",{ref:"contentView",attrs:{base_name:t.contentAlbumName,album_friendly_name:t.contentFriendlyName,sidebar_shown_pc:t.sidebar_shown_on_pc_mode},on:{"should-show-sidebar":(e,s)=>"mobile"===s?t.sidebar_shown_on_mobile_mode=e:t.sidebar_shown_on_pc_mode=e,"preview-photo":(e,s,a,i,o,n)=>t.previewPhoto(e,s,a,i,o,n)}})],1),e("div",{directives:[{name:"show",rawName:"v-show",value:t.sidebar_shown_on_mobile_mode,expression:"sidebar_shown_on_mobile_mode"}],staticClass:"sidebar-mobile-mask",on:{click:function(e){t.sidebar_shown_on_mobile_mode=!1}}}),e("div",{class:["sidebar-container",t.sidebar_shown_on_pc_mode?"":"side-hidden-screen",t.sidebar_shown_on_mobile_mode?"sidebar-mobile-shown":""]},[e("Sidebar",{ref:"sidebar",attrs:{people_enabled:t.people_enabled},on:{"switch-album":(t,e)=>{this.contentAlbumName=t,this.contentFriendlyName=e},"should-show-sidebar":(e,s)=>"mobile"===s?t.sidebar_shown_on_mobile_mode=e:t.sidebar_shown_on_pc_mode=e,"open-settings":function(e){t.settings_shown=!0}}})],1),e("div",{directives:[{name:"show",rawName:"v-show",value:t.preview_shown,expression:"preview_shown"}],staticClass:"preview-container"},[e("Preview",{attrs:{current_photo_filename:t.preview_filename,image_list:t.preview_imagelist,index:t.preview_index,current_album_name:t.preview_album_name,catalog_name:t.contentFriendlyName,current_photo:t.preview_current_obj,photo_count:t.preview_photo_count},on:{"hide-preview":function(e){t.preview_shown=!1},"change-photo":(e,s,a,i,o)=>t.previewPhoto(e,s,a,i,o,t.preview_photo_count),"load-more-photos":e=>t.loadMorePhotos(e)}})],1),e("div",{directives:[{name:"show",rawName:"v-show",value:t.password_input_shown,expression:"password_input_shown"}],staticClass:"password-container"},[e("PasswordInput",{ref:"password_input",on:{"submit-password":e=>t.checkPassword(e)}})],1),e("div",{directives:[{name:"show",rawName:"v-show",value:t.settings_shown,expression:"settings_shown"}],staticClass:"settings-container"},[e("Settings",{on:{"close-settings":function(e){t.settings_shown=!1}}})],1)])},o=[],n=function(){var t=this,e=t._self._c;return e("div",{staticStyle:{"padding-left":"10px","padding-right":"10px",height:"100%","overflow-y":"auto"},on:{scroll:t.handleScroll}},[e("div",{class:["navbar",t.shouldShowSemiTransparentNavBar?"":"large"]},[e("div",{staticClass:"nav-title"},[t._v(" "+t._s(t.tr("Photos"))+" ")]),e("div",{staticClass:"left-button-group"},[e("a",{staticClass:"hidden-btn",attrs:{href:"javascript:void(0)"},on:{click:()=>{this.raise_event_show_sidebar(!1,"mobile"),this.raise_event_show_sidebar(!1,"pc")}}},[e("IconBase",{attrs:{"icon-color":"#5555ff"}},[e("IconSideBar")],1)],1)]),e("div",{staticClass:"right-button-group"},[e("a",{staticStyle:{"margin-right":"10px"},attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.openSettings()}}},[e("IconBase",{attrs:{"icon-color":"#5555ff",height:"21"}},[e("IconSettings")],1)],1),e("a",{attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.logout()}}},[e("IconBase",{attrs:{"icon-color":"#5555ff",height:"21"}},[e("IconExit")],1)],1)])]),e("div",{staticClass:"title1 navtitle",style:{marginTop:"50px",opacity:1-t.shouldShowSemiTransparentNavBar}},[t._v(" "+t._s(t.tr("Photos"))+" ")]),e("div",{staticClass:"listview normal-menu-ui",staticStyle:{"margin-top":"5px"}},[e("a",{directives:[{name:"show",rawName:"v-show",value:t.show_banner,expression:"show_banner"}],class:t.get_css_class_list_item("/all"),attrs:{href:"javascript:void(0)"},on:{click:function(e){t.on_switch_album("/all",t.tr("sidebar.photo_library"))}}},[e("span",[t._v(" "+t._s(t.tr("sidebar.photo_library"))+" ")])]),e("a",{directives:[{name:"show",rawName:"v-show",value:t.show_banner,expression:"show_banner"}],class:t.get_css_class_list_item("/recent"),attrs:{href:"javascript:void(0)"},on:{click:function(e){t.on_switch_album("/recent",t.tr("sidebar.recent"))}}},[e("span",[t._v(t._s(t.tr("sidebar.recent")))])]),e("a",{class:t.get_css_class_list_item("/fav"),attrs:{href:"javascript:void(0)"},on:{click:function(e){t.on_switch_album("/fav",t.tr("sidebar.favorites"))}}},[e("span",[t._v(t._s(t.tr("sidebar.favorites")))])])]),e("div",{staticClass:"title2"},[t._v(" "+t._s(t.tr("My Albums"))+" ")]),e("div",{staticClass:"listview"},t._l(t.album_list,(function(s){return e("a",{key:s.name,class:["album-prev",t.get_css_class_list_item(s.name)],attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.on_switch_album(s.name,s.friendly_name)}}},[e("div",{staticStyle:{position:"relative"}},[e("div",{staticClass:"list_img",style:{backgroundImage:""===s.preview?"":"url('/api/album-cache/"+s.name+"/"+s.preview+"')"}}),e("span",{staticStyle:{"margin-left":"27px"}},[t._v(t._s(s.friendly_name))])])])})),0),e("div",{directives:[{name:"show",rawName:"v-show",value:t.people_enabled&&t.people_categories.length>0,expression:"people_enabled && people_categories.length > 0"}],staticClass:"title2"},[t._v(" "+t._s(t.tr("People"))+" ")]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.people_enabled&&t.people_categories.length>0,expression:"people_enabled && people_categories.length > 0"}],staticClass:"people-list"},t._l(t.people_categories,(function(s){return e("div",{key:s.id,class:["people",t.get_css_class_list_item("/people/category-"+s.id)],style:{backgroundImage:"url('/api/album-cache/"+s.preview.al+"/"+s.preview.name+"')",backgroundPosition:t.calcCenterFaceBgpos(s.preview)},on:{click:function(e){t.on_switch_album("/people/category-"+s.id,t.tr("sidebar.people.title",s.id+1))}}})})),0)])},r=[],l=(s("f33e"),s("bfe0"),s("9b91"),s("8e9e"),s("a6d2"),s("6886"),s("2c6c"),s("66bf"),s("e51b"),{Photos:"照片","My Albums":"我的相簿","sidebar.photo_library":"图库","sidebar.recent":"最近项目","sidebar.favorites":"个人收藏",People:"人物","sidebar.people.title":"人物{0}","sidebar.shared_album":"共享的相册","content.photo_count":"{0}张图片","content.ctx_menu.zoom_in":"放大","content.ctx_menu.zoom_out":"缩小","content.ctx_menu.default_scale":"默认缩放 (当前: {0})","content.ctx_menu.share":"分享...","content.ctx_menu.export_fav":"导出个人收藏","content.ctx_menu.import_fav":"导入个人收藏","content.share_dialog.title":"分享相册","content.share_dialog.sharing":"共享相册：","content.share_dialog.set_password_label":"设置分享密码：","content.share_dialog.share_btn":"分享","content.share_dialog.share_link_is":"分享链接为：","content.share_dialog.share_link_desc_1":"将这个链接发送给其他人即可分享该相册，无需将相册的访问密码提供给对方。\n获得该分享链接的人需要输入分享密码方可查看。","content.share_dialog.share_link_desc_2":"如果想要取消对方的访问权限，请使用项目提供的工具重新生成分享API。","content.share_dialog.unsharable":"不能分享该相册。","content.fav.unsupported":"你的浏览器不支持Local Storage，无法使用此功能。","content.fav.unrecognized":"选择的文件无法识别！","popup.complete_btn":"完成","pwdi.title":"相册","pwdi.hint":"请输入密码以访问相册。","pwdi.retry":"密码错误，请重新输入！",Password:"密码",OK:"确定","preview.loading":"正在加载图片...","preview.download_btn":"下载","preview.zoom_in":"放大","preview.zoom_out":"缩小","preview.reset_zoom":"重置","preview.prev_photo":"上一张","preview.next_photo":"下一张",Album:"相册",Settings:"设置",General:"通用",Language:"语言",About:"关于",Close:"关闭","settings.language_hint":"修改语言后会自动刷新页面。","settings.license":"Licensed: MIT License"}),h={"sidebar.photo_library":"Library","sidebar.recent":"Recent","sidebar.favorites":"Favorites","sidebar.people.title":"People {0}","sidebar.shared_album":"Shared Album","content.photo_count":"{0} Photos","content.ctx_menu.zoom_in":"Zoom In","content.ctx_menu.zoom_out":"Zoom Out","content.ctx_menu.default_scale":"Default Scaling (Current: {0})","content.ctx_menu.share":"Share...","content.ctx_menu.export_fav":"Export Favorites","content.ctx_menu.import_fav":"Import Favorites","content.share_dialog.title":"Share Album","content.share_dialog.sharing":"Sharing: ","content.share_dialog.set_password_label":"Set password for sharing:","content.share_dialog.share_btn":"Share","content.share_dialog.share_link_is":"The permalink is:","content.share_dialog.share_link_desc_1":"Send this link to others to share the album without providing them with the album access password.\nThe person who gets the sharing link needs to enter the sharing password before they can view it.","content.share_dialog.share_link_desc_2":"If you want to revoke the access rights, please use the tools provided by this project to regenerate the sharing API.","content.share_dialog.unsharable":"You can't share this album.","content.fav.unsupported":"This feature is unavailable because your browser does not support Local Storage.","content.fav.unrecognized":"The selected file is not recognized!","popup.complete_btn":"Complete","pwdi.title":"Album","pwdi.hint":"Please input password to access the albums.","pwdi.retry":"Password is incorrect, please try again!","preview.loading":"Loading image...","preview.download_btn":"Download","preview.zoom_in":"Zoom In","preview.zoom_out":"Zoom Out","preview.reset_zoom":"Reset","preview.prev_photo":"Previous","preview.next_photo":"Next",Settings:"Settings",General:"General",Language:"Language",About:"About",Close:"Close","settings.language_hint":"The page will automatically refresh after changing the language.","settings.license":"Licensed: MIT License"};let c={"zh-CN":l,"en-US":h};function d(){let t=navigator.language;if(window.localStorage){let e=window.localStorage.getItem("language");"undefined"!==typeof e&&null!=e&&e.length&&(t=e)}return t.startsWith("en")?"en-US":t}let _=d();function u(t,...e){return 0===e.length?t:t.replace(/\{(\d+)\}/g,(function(t,s){return"undefined"!=typeof e[s]?e[s]:t}))}function p(t,...e){let s=_;"undefined"==typeof c[s]&&(_="en-US");let a=c[s][t];return"undefined"==typeof a?u(t,...e):u(a,...e)}console.log("Current language is",_);var g={i18n_translate:p};function m(t){let e=".";return window.enabled_password&&(e=window.miyuki_password),new Promise((s,a)=>{fetch(`/api/${e}/${t}.json`).then((function(t){if(t.ok)return s(t.json());throw new Error("Network response was not ok: url")})).catch((function(e){console.error("HTTP Request: /GET "+t+" [FAILED]",e),a(e)}))})}function f(t){return new Promise((e,s)=>{fetch(`/api/${t}.json`).then((function(t){if(t.ok)return e(t.json());throw new Error("Network response was not ok: url")})).catch((function(e){console.error("HTTP Request: /GET "+t+" [FAILED]",e),s(e)}))})}function w(t,e){if(32!==t.length||32!==e.length)throw new Error("Both MD5 strings must be 32 characters long.");var s=Array(32).fill(0);for(let a=0;a<32;a++){let i=Number.parseInt(t[a],16),o=Number.parseInt(e[a],16);s[a]=(i^o).toString(16)}return s.join("")}function v(t,e){const s=new Blob([t],{type:"text/plain"}),a=document.createElement("a");a.href=URL.createObjectURL(s),a.download=e,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)}function b(){const t=new Date,e=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0"),i=String(t.getHours()).padStart(2,"0"),o=String(t.getMinutes()).padStart(2,"0"),n=String(t.getSeconds()).padStart(2,"0");return`${e}${s}${a}_${i}${o}${n}`}function C(t=".txt"){return new Promise((e,s)=>{const a=document.createElement("input");a.type="file",a.accept=t,a.addEventListener("change",(function(t){const a=t.target.files[0];if(a){const t=new FileReader;t.onload=function(t){const s=t.target.result;e(s)},t.onerror=function(t){s(t.target.error)},t.readAsText(a)}else s(new Error("No file selected."))})),a.click()})}function S(t){if("undefined"==typeof t.faces)return"0px 0px";let e=t.faces;if(0==e.length)return"0px 0px";let s=e.map(t=>t[0]).reduce((t,e)=>t+e,0)/e.length,a=e.map(t=>t[1]).reduce((t,e)=>t+e,0)/e.length,i=e.map(t=>t[2]).reduce((t,e)=>t+e,0)/e.length,o=e.map(t=>t[3]).reduce((t,e)=>t+e,0)/e.length,n=s+i/2,r=a+o/2,l=t.w,h=t.h,c=l<h;c&&([h,l]=[l,h],[n,r]=[r,n]);let d=n/l,_=(l-h)/l,u=h/l,p=1/_,g=p*(d-u/2);return g=Math.max(0,Math.min(1,g)),c?`0 ${100*g}%`:100*g+"% 0"}var y={get_secured_json:m,get_json:f,md5_transform:w,download_text_as_file:v,get_current_time_f:b,get_file_content:C,calc_center_face_bg_pos:S,translate:g.i18n_translate},x=function(){var t=this,e=t._self._c;return e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:t.width,height:t.height}},[e("g",{attrs:{fill:t.iconColor}},[t._t("default")],2)])},k=[],L={name:"IconBase.vue",props:{width:{type:[Number,String],default:25},height:{type:[Number,String],default:18},iconColor:{type:String,default:"currentColor"}}},P=L,M=(s("b979"),s("1805")),I=Object(M["a"])(P,x,k,!1,null,"107806a9",null),z=I.exports,T=function(){var t=this,e=t._self._c;return e("path",{attrs:{d:"M3.06641 17.998L19.9609 17.998C22.0117 17.998 23.0273 16.9824 23.0273 14.9707L23.0273 3.04688C23.0273 1.03516 22.0117 0.0195312 19.9609 0.0195312L3.06641 0.0195312C1.02539 0.0195312 0 1.02539 0 3.04688L0 14.9707C0 16.9922 1.02539 17.998 3.06641 17.998ZM3.08594 16.4258C2.10938 16.4258 1.57227 15.9082 1.57227 14.8926L1.57227 3.125C1.57227 2.10938 2.10938 1.5918 3.08594 1.5918L19.9414 1.5918C20.9082 1.5918 21.4551 2.10938 21.4551 3.125L21.4551 14.8926C21.4551 15.9082 20.9082 16.4258 19.9414 16.4258ZM7.44141 16.7285L8.97461 16.7285L8.97461 1.29883L7.44141 1.29883ZM5.56641 5.21484C5.85938 5.21484 6.12305 4.95117 6.12305 4.66797C6.12305 4.375 5.85938 4.12109 5.56641 4.12109L3.4668 4.12109C3.17383 4.12109 2.91992 4.375 2.91992 4.66797C2.91992 4.95117 3.17383 5.21484 3.4668 5.21484ZM5.56641 7.74414C5.85938 7.74414 6.12305 7.48047 6.12305 7.1875C6.12305 6.89453 5.85938 6.65039 5.56641 6.65039L3.4668 6.65039C3.17383 6.65039 2.91992 6.89453 2.91992 7.1875C2.91992 7.48047 3.17383 7.74414 3.4668 7.74414ZM5.56641 10.2637C5.85938 10.2637 6.12305 10.0195 6.12305 9.72656C6.12305 9.43359 5.85938 9.17969 5.56641 9.17969L3.4668 9.17969C3.17383 9.17969 2.91992 9.43359 2.91992 9.72656C2.91992 10.0195 3.17383 10.2637 3.4668 10.2637Z","fill-opacity":"0.85"}})},N=[],E={},j=Object(M["a"])(E,T,N,!1,null,null,null),Y=j.exports,$=function(){var t=this,e=t._self._c;return e("g",[e("path",{attrs:{d:"M3.02734 20.9375L13.3984 20.9375C15.4199 20.9375 16.4258 19.9219 16.4258 17.8809L16.4258 3.06641C16.4258 1.03516 15.4199 0 13.3984 0L3.02734 0C1.01562 0 0 1.03516 0 3.06641L0 17.8809C0 19.9219 1.01562 20.9375 3.02734 20.9375ZM1.57227 17.8516L1.57227 3.0957C1.57227 2.11914 2.09961 1.57227 3.11523 1.57227L13.3203 1.57227C14.3359 1.57227 14.8535 2.11914 14.8535 3.0957L14.8535 17.8516C14.8535 18.8281 14.3359 19.3652 13.3203 19.3652L3.11523 19.3652C2.09961 19.3652 1.57227 18.8281 1.57227 17.8516Z","fill-opacity":"0.85"}}),e("path",{attrs:{d:"M9.04297 13.1348L21.9141 13.1348C23.3594 13.1348 24.5605 11.9238 24.5605 10.4688C24.5605 9.01367 23.3594 7.80273 21.9141 7.80273L9.04297 7.80273C7.58789 7.80273 6.39648 9.01367 6.39648 10.4688C6.39648 11.9238 7.58789 13.1348 9.04297 13.1348Z",fill:"aliceblue"}}),e("path",{attrs:{d:"M9.04297 11.2402L19.0723 11.2402L20.5273 11.1816L19.8438 11.8457L18.2617 13.3203C18.1055 13.457 18.0273 13.6621 18.0273 13.8477C18.0273 14.2578 18.3203 14.5605 18.7109 14.5605C18.9258 14.5605 19.082 14.4824 19.2285 14.3359L22.4121 11.0352C22.6074 10.8398 22.6758 10.6641 22.6758 10.4688C22.6758 10.2637 22.6074 10.0977 22.4121 9.90234L19.2285 6.60156C19.082 6.45508 18.9258 6.36719 18.7109 6.36719C18.3203 6.36719 18.0273 6.66016 18.0273 7.07031C18.0273 7.26562 18.1055 7.4707 18.2617 7.60742L19.8438 9.0918L20.5371 9.75586L19.0723 9.6875L9.04297 9.6875C8.63281 9.6875 8.28125 10.0488 8.28125 10.4688C8.28125 10.8887 8.63281 11.2402 9.04297 11.2402Z","fill-opacity":"0.85"}})])},X=[],O={},B=Object(M["a"])(O,$,X,!1,null,null,null),D=B.exports,F=function(){var t=this,e=t._self._c;return e("g",[e("path",{attrs:{d:"M19.14 12.94C19.18 12.64 19.21 12.34 19.21 12.03C19.21 11.72 19.18 11.42 19.14 11.12L20.96 9.78C21.12 9.66 21.16 9.44 21.07 9.26L19.26 6.26C19.17 6.08 18.97 6 18.78 6.07L16.78 6.88C16.35 6.54 15.88 6.26 15.37 6.06L15.03 3.68C15.01 3.5 14.85 3.36 14.67 3.36H9.33C9.15 3.36 8.99 3.5 8.97 3.68L8.63 6.06C8.12 6.26 7.65 6.54 7.22 6.88L5.22 6.07C5.03 6 4.83 6.08 4.74 6.26L2.93 9.26C2.84 9.44 2.88 9.66 3.04 9.78L4.86 11.12C4.82 11.42 4.79 11.72 4.79 12.03C4.79 12.34 4.82 12.64 4.86 12.94L3.04 14.28C2.88 14.4 2.84 14.62 2.93 14.8L4.74 17.8C4.83 17.98 5.03 18.06 5.22 17.99L7.22 17.18C7.65 17.52 8.12 17.8 8.63 18L8.97 20.38C8.99 20.56 9.15 20.7 9.33 20.7H14.67C14.85 20.7 15.01 20.56 15.03 20.38L15.37 18C15.88 17.8 16.35 17.52 16.78 17.18L18.78 17.99C18.97 18.06 19.17 17.98 19.26 17.8L21.07 14.8C21.16 14.62 21.12 14.4 20.96 14.28L19.14 12.94ZM12 15.5C10.07 15.5 8.5 13.93 8.5 12C8.5 10.07 10.07 8.5 12 8.5C13.93 8.5 15.5 10.07 15.5 12C15.5 13.93 13.93 15.5 12 15.5Z"}})])},A=[],Z={},H=Object(M["a"])(Z,F,A,!1,null,null,null),W=H.exports,R={name:"Sidebar",components:{IconSideBar:Y,IconBase:z,IconExit:D,IconSettings:W},props:["people_enabled"],data:()=>({album_list:[],selected_album_name:"/all",show_banner:!0,shouldShowSemiTransparentNavBar:!1,people_categories:[]}),methods:{tr(t,...e){return y.translate(t,...e)},raise_event_show_sidebar(t,e){this.$emit("should-show-sidebar",t,e)},on_switch_album(t,e){this.$emit("switch-album",t,e),this.selected_album_name=t,window.innerWidth<=1200&&this.raise_event_show_sidebar(!1,"mobile")},get_css_class_list_item(t){return t===this.selected_album_name?"selected":""},handleScroll:function(t){console.log(t.srcElement.scrollTop),t.srcElement.scrollTop>=30?this.shouldShowSemiTransparentNavBar=!0:(console.log("ttt"),this.shouldShowSemiTransparentNavBar=!1)},async getAlbumList(){if(this.album_list=await y.get_secured_json("get-album"),this.people_enabled){const t=await y.get_secured_json("people/categories");this.people_categories=t.categories}},async getAlbumListForShare(t){window.share_album_hash=t;let e={name:"/share",friendly_name:"共享的相册",preview:""};this.album_list=[e],this.show_banner=!1,this.on_switch_album(e["name"],e["friendly_name"])},logout(){localStorage.removeItem("password"),location.reload()},calcCenterFaceBgpos(t){return y.calc_center_face_bg_pos(t)},openSettings(){this.$emit("open-settings")}}},K=R,U=Object(M["a"])(K,n,r,!1,null,"607be546",null),q=U.exports,G=function(){var t=this,e=t._self._c;return e("div",{staticStyle:{height:"100%","overflow-y":"auto"},on:{scroll:t.handleScroll}},[e("div",{staticClass:"cnav"},[e("div",{class:["title","left",t.sidebar_shown_pc?"":"sidebar-hidden"]},[e("span",{staticClass:"title-text"},[t._v(t._s(t.album_friendly_name))])]),e("div",{staticClass:"title right"},[e("span",{staticStyle:{color:"#eee","margin-right":"10px"}},[t._v(t._s(t.tr("content.photo_count",t.photo_count)))]),e("button",{on:{click:function(e){t.menu_more_is_shown=!t.menu_more_is_shown}}},[t._v("...")]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.menu_more_is_shown,expression:"menu_more_is_shown"}],staticClass:"context-menu-mask",on:{click:function(e){t.menu_more_is_shown=!1}}}),e("div",{directives:[{name:"show",rawName:"v-show",value:t.menu_more_is_shown,expression:"menu_more_is_shown"}],class:["context-menu",t.menu_more_is_shown?"shown":"hidden"],staticStyle:{top:"56px",right:"20px"}},[e("a",{attrs:{href:"javascript:void(0)","aria-disabled":t.current_zoom_scale>=2},on:{click:function(e){t.current_zoom_scale<2&&(t.current_zoom_scale++,t.menu_more_is_shown=!1)}}},[t._v(t._s(t.tr("content.ctx_menu.zoom_in")))]),e("a",{attrs:{href:"javascript:void(0)","aria-disabled":t.current_zoom_scale<=-6},on:{click:function(e){t.current_zoom_scale>-6&&(t.current_zoom_scale--,t.menu_more_is_shown=!1)}}},[t._v(t._s(t.tr("content.ctx_menu.zoom_out")))]),e("a",{attrs:{href:"javascript:void(0)","aria-disabled":0==t.current_zoom_scale},on:{click:function(e){0!=t.current_zoom_scale&&(t.current_zoom_scale=0,t.menu_more_is_shown=!1)}}},[t._v(t._s(t.tr("content.ctx_menu.default_scale",t.current_zoom_scale)))]),e("hr",{directives:[{name:"show",rawName:"v-show",value:"/"!==t.base_name[0],expression:"base_name[0] !== '/'"}]}),e("a",{directives:[{name:"show",rawName:"v-show",value:"/"!==t.base_name[0],expression:"base_name[0] !== '/'"}],attrs:{href:"javascript:void(0)","aria-disabled":!t.share_enabled},on:{click:function(e){return t.shareAlbumClick()}}},[t._v(t._s(t.tr("content.ctx_menu.share")))]),e("hr",{directives:[{name:"show",rawName:"v-show",value:"/fav"===t.base_name,expression:"base_name === '/fav'"}]}),e("a",{directives:[{name:"show",rawName:"v-show",value:"/fav"===t.base_name,expression:"base_name === '/fav'"}],attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.exportFavClick()}}},[t._v(t._s(t.tr("content.ctx_menu.export_fav")))]),e("a",{directives:[{name:"show",rawName:"v-show",value:"/fav"===t.base_name,expression:"base_name === '/fav'"}],attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.importFavClick()}}},[t._v(t._s(t.tr("content.ctx_menu.import_fav")))])])]),e("div",{staticClass:"back left",staticStyle:{"line-height":"45px",left:"18px",top:"0"},on:{click:function(e){return t.raise_event_show_sidebar(!0,"mobile")}}},[e("i",{staticClass:"larrow",staticStyle:{"border-color":"white"}}),e("span",{staticClass:"backtext"},[t._v(t._s(t.tr("Photos")))])]),e("div",{class:["back","left","sidebar-hidden-left",t.sidebar_shown_pc?"":"sidebar-hidden"],staticStyle:{"line-height":"45px",left:"18px",top:"0"},on:{click:function(e){return t.raise_event_show_sidebar(!0,"pc")}}},[e("span",{staticClass:"backtext"},[e("IconBase",{attrs:{"icon-color":"white"}},[e("IconSideBar")],1)],1)])]),e("div",t._l(t.photo_list,(function(s,a){return e("div",{key:a,class:["photo","box","scale-ratio-ratio-"+t.current_zoom_scale],style:{backgroundImage:`url('${t.get_thumbnail_image(s.al,s.name)}')`,backgroundPosition:t.get_thumbnail_image_backgrouod_pos(s)},attrs:{"photo-name":s.name}},[e("div",{staticClass:"photo-mask",staticStyle:{position:"absolute",left:"0",top:"0",width:"100%",height:"100%"},on:{click:function(e){return t.raise_event_show_preview(s.name,t.photo_list,a,s.al,s)}}}),e("div",{staticClass:"fav-btn",style:{position:"absolute",left:"20px",bottom:"20px",display:s.fav?"block":""},on:{click:function(e){return t.switchFavState(s)}}},[s.fav?e("IconBase",{attrs:{"icon-color":"white"}},[e("IconHeartFilled")],1):e("IconBase",{attrs:{"icon-color":"white"}},[e("IconHeart")],1)],1)])})),0),e("div",{directives:[{name:"show",rawName:"v-show",value:t.popup_dialog_shown,expression:"popup_dialog_shown"}],staticClass:"dialog-container"},[e("PopupDialog",{ref:"popup_dialog",attrs:{title:t.tr("content.share_dialog.title")},on:{"complete-click":()=>{t.popup_dialog_shown=!1}}},[e("div",{directives:[{name:"show",rawName:"v-show",value:1===t.share_dialog_phase&&t.share_enabled,expression:"share_dialog_phase === 1 && share_enabled"}]},[e("p",[t._v(" "+t._s(t.tr("content.share_dialog.sharing"))+" "),e("span",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(t.album_friendly_name))])]),e("p",[t._v(t._s(t.tr("content.share_dialog.set_password_label")))]),e("p",[e("input",{directives:[{name:"model",rawName:"v-model",value:t.share_password,expression:"share_password"}],ref:"password_input",staticStyle:{width:"calc(100% - 15px)"},attrs:{type:"password"},domProps:{value:t.share_password},on:{input:function(e){e.target.composing||(t.share_password=e.target.value)}}})]),e("span",{staticClass:"mbutton-group",staticStyle:{"text-align":"center",display:"block"}},[e("button",{staticClass:"primary large_button primary_btn",on:{click:function(e){return t.shareButtonClick()}}},[t._v(t._s(t.tr("content.share_dialog.share_btn")))])])]),e("div",{directives:[{name:"show",rawName:"v-show",value:2===t.share_dialog_phase&&t.share_enabled,expression:"share_dialog_phase === 2 && share_enabled"}]},[e("p",[t._v(t._s(t.tr("content.share_dialog.share_link_is")))]),e("pre",{staticClass:"share_url"},[t._v(t._s(t.share_url))]),e("p",[t._v(t._s(t.tr("content.share_dialog.share_link_desc_1")))]),e("p",[t._v(t._s(t.tr("content.share_dialog.share_link_desc_2")))])]),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.share_enabled,expression:"!share_enabled"}]},[e("p",[t._v(t._s(t.tr("content.share_dialog.unsharable")))])])])],1)])},J=[],V=(s("f640"),s("eacf"),s("6c84"),s("7f5e"),function(){var t=this,e=t._self._c;return e("path",{attrs:{d:"M0 6.49414C0 10.6543 3.48633 14.7461 8.99414 18.2617C9.19922 18.3887 9.49219 18.5254 9.69727 18.5254C9.90234 18.5254 10.1953 18.3887 10.4102 18.2617C15.9082 14.7461 19.3945 10.6543 19.3945 6.49414C19.3945 3.03711 17.0215 0.595703 13.8574 0.595703C12.0508 0.595703 10.5859 1.45508 9.69727 2.77344C8.82812 1.46484 7.34375 0.595703 5.53711 0.595703C2.37305 0.595703 0 3.03711 0 6.49414ZM1.57227 6.49414C1.57227 3.89648 3.25195 2.16797 5.51758 2.16797C7.35352 2.16797 8.4082 3.31055 9.0332 4.28711C9.29688 4.67773 9.46289 4.78516 9.69727 4.78516C9.93164 4.78516 10.0781 4.66797 10.3613 4.28711C11.0352 3.33008 12.0508 2.16797 13.877 2.16797C16.1426 2.16797 17.8223 3.89648 17.8223 6.49414C17.8223 10.127 13.9844 14.043 9.90234 16.7578C9.80469 16.8262 9.73633 16.875 9.69727 16.875C9.6582 16.875 9.58984 16.8262 9.50195 16.7578C5.41016 14.043 1.57227 10.127 1.57227 6.49414Z","fill-opacity":"0.85"}})}),Q=[],tt={},et=Object(M["a"])(tt,V,Q,!1,null,null,null),st=et.exports,at=function(){var t=this,e=t._self._c;return e("path",{attrs:{d:"M9.69727 18.5254C9.90234 18.5254 10.1953 18.3887 10.4102 18.2617C15.9082 14.7461 19.3945 10.6543 19.3945 6.49414C19.3945 3.03711 17.0215 0.595703 13.9551 0.595703C12.0508 0.595703 10.5859 1.65039 9.69727 3.26172C8.82812 1.66016 7.34375 0.595703 5.43945 0.595703C2.37305 0.595703 0 3.03711 0 6.49414C0 10.6543 3.48633 14.7461 8.99414 18.2617C9.19922 18.3887 9.49219 18.5254 9.69727 18.5254Z","fill-opacity":"0.85"}})},it=[],ot={},nt=Object(M["a"])(ot,at,it,!1,null,null,null),rt=nt.exports,lt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"popd"},[e("div",{staticStyle:{position:"relative",height:"100%",width:"100%",margin:"0 0"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:!0,expression:"true || password_dialog_shown"}],staticClass:"dialog"},[e("div",{staticClass:"title"},[t._v(" "+t._s(t.title)+" ")]),e("div",{staticClass:"ctnt",staticStyle:{"text-align":"left"}},[t._t("default")],2),e("div",{staticClass:"cbgroup",staticStyle:{"padding-top":"3px","text-align":"right","padding-right":"10px"}},[e("button",{staticClass:"complete",attrs:{disabled:!t.password_dialog_shown},on:{click:function(e){return t.completeClick()}}},[t._v(t._s(t.tr("popup.complete_btn")))])])])])])},ht=[];s("b767");s("30d7");var ct={name:"PasswordInput",props:["title"],data:()=>({password_dialog_shown:!0}),methods:{tr(t,...e){return y.translate(t,...e)},async completeClick(){this.$emit("complete-click")},feedback(t){t||(this.password_dialog_shown=!0)}}},dt=ct,_t=Object(M["a"])(dt,lt,ht,!1,null,"808765de",null),ut=_t.exports;let pt=s("30d7");const gt=50;var mt={name:"Content",components:{IconSideBar:Y,IconBase:z,IconHeart:st,IconHeartFilled:rt,PopupDialog:ut},props:["base_name","album_friendly_name","sidebar_shown_pc"],data(){return{page_count:0,current_page_to_load:0,photo_count:0,photo_list:[],album_hash:"",initial_scroll_height:0,response_load_new:!0,fav_content_cache:{},fav_page_cache:null,menu_more_is_shown:!1,current_zoom_scale:0,share_enabled:!1,popup_dialog_shown:!1,share_dialog_phase:1,share_password:"",share_url:""}},computed:{album_common_prefix(){return"/all"===this.base_name?"get-photo-":"/recent"===this.base_name?"get-recent-photo-":"/fav"===this.base_name?"get-fav-photo-":"/share"===this.base_name?"get-shared-photo-":this.base_name+"-get-photo-"},album_get_count_json_name(){return this.album_common_prefix+"count"},album_get_image_at_current_page_json_name(){return this.album_common_prefix+"page-"+String(this.current_page_to_load)}},watch:{base_name(){this.initialize()}},created(){},async mounted(){this.initialize()},methods:{tr(t,...e){return y.translate(t,...e)},raise_event_show_sidebar(t,e){this.$emit("should-show-sidebar",t,e)},raise_event_show_preview(t,e,s,a,i){this.$emit("preview-photo",t,e,s,a,i,this.photo_count)},async load_image(){if(this.response_load_new)if(this.response_load_new=!1,setTimeout(()=>{this.response_load_new=!0},1e3),this.current_page_to_load>=this.page_count)this.response_load_new=!0;else{if(this.album_get_count_json_name.startsWith("get-fav-photo-")){let t=Math.min(this.photo_list.length+gt,this.fav_page_cache.length);for(let e=this.photo_list.length;e<t;e++)this.photo_list.push(this.fav_page_cache[e])}else if(this.album_get_count_json_name.startsWith("get-shared-photo-")){let t=window.share_album_hash;if("undefined"===typeof window.share_album_hash)throw Error("share_album_hash not defined");console.log("share_album_hash",t),this.photo_list.push(...await y.get_json(`shared/${t}-get-photo-page-${String(this.current_page_to_load)}`))}else this.photo_list.push(...await y.get_secured_json(this.album_get_image_at_current_page_json_name)),this.applyFavoriteWithPhotos();this.current_page_to_load++,this.response_load_new=!0}},get_thumbnail_image(t,e){return"/api/album-cache/"+t+"/"+e},get_thumbnail_image_backgrouod_pos(t){return y.calc_center_face_bg_pos(t)},async initialize(){if(""!==this.base_name){if(this.current_page_to_load=0,this.photo_list=[],this.response_load_new=!0,this.initial_scroll_height=0,this.photo_count=this.page_count=0,this.album_hash="",this.album_get_count_json_name.startsWith("get-fav-photo-")){if(null==this.fav_page_cache||0==this.current_page_to_load){this.fav_page_cache=[],this.loadAllFavoriteItems();for(let t in this.fav_content_cache)for(let e in this.fav_content_cache[t])this.fav_page_cache.push(this.fav_content_cache[t][e])}this.photo_count=this.fav_page_cache.length,this.share_enabled=!1,this.album_hash=""}else if(this.album_get_count_json_name.startsWith("get-shared-photo-")){let t=window.share_album_hash;if("undefined"===typeof window.share_album_hash)throw Error("share_album_hash not defined");console.log("share_album_hash",t);let e=await y.get_json(`shared/${t}-get-photo-count`);this.photo_count=e.count,this.album_hash="",this.share_enabled=!1}else{let t=await y.get_secured_json(this.album_get_count_json_name);this.photo_count=t.count,this.album_hash=t.hash,this.share_enabled="undefined"!==typeof t.hash}this.page_count=Math.ceil(this.photo_count/gt),this.page_count>0&&this.load_image()}},handleScroll:function(t){0===this.initial_scroll_height&&(this.initial_scroll_height=t.srcElement.scrollHeight/10),t.srcElement.offsetHeight+t.srcElement.scrollTop>=t.srcElement.scrollHeight-this.initial_scroll_height&&this.load_image()},isFavorite(t){return t.fav},getFavoriteStorageKey(t){return`${t.al}/${t.name}`},getFavoriteLocalStorageKey(t){return"album_fav_"+t.al},getFavoriteLocalStorageAllKeys(){let t=[];for(let e=0,s=localStorage.length;e<s;++e){let s=localStorage.key(e);s.startsWith("album_fav_")&&t.push(s)}return t},loadAllFavoriteItems(){this.fav_content_cache={};let t=this.getFavoriteLocalStorageAllKeys();for(let e=0;e<t.length;e++)this.fav_content_cache[t[e]]=JSON.parse(localStorage.getItem(t[e]))},applyFavoriteWithPhotos(){this.loadAllFavoriteItems();for(let t=0;t<this.photo_list.length;t++){let e=this.getFavoriteStorageKey(this.photo_list[t]),s=this.getFavoriteLocalStorageKey(this.photo_list[t]);"undefined"!=typeof this.fav_content_cache[s]&&("undefined"!=typeof this.fav_content_cache[s][e]&&(this.photo_list[t].fav=!0))}this.$forceUpdate()},saveFavoriteState(t){let e=this.getFavoriteStorageKey(t),s=this.getFavoriteLocalStorageKey(t);"undefined"==typeof this.fav_content_cache[s]&&(this.fav_content_cache[s]={}),t.fav?this.fav_content_cache[s][e]=t:delete this.fav_content_cache[s][e];let a=window.localStorage;"undefined"!==typeof a?a.setItem(s,JSON.stringify(this.fav_content_cache[s])):alert(this.tr("content.fav.unsupported"))},switchFavState(t){t.fav=!t.fav,this.$forceUpdate(),this.saveFavoriteState(t)},shareAlbumClick(){"undefined"!==typeof this.album_hash&&""!==this.album_hash&&(this.share_dialog_phase=1,this.popup_dialog_shown=!0,this.menu_more_is_shown=!1)},shareButtonClick(){if(""===this.share_password)return;let t=pt(this.share_password);console.log("password hash:",t),console.log("album hash:   ",this.album_hash);let e=y.md5_transform(this.album_hash,t),s=y.md5_transform(e,t);console.log("encrypted:    ",e),console.log("decrypted:    ",s),this.share_dialog_phase=2,this.share_url=location.href.split("?")[0].split("#")[0]+"?shared_id="+e,this.share_password=""},exportFavClick(){this.menu_more_is_shown=!1;let t=this.getFavoriteLocalStorageAllKeys();console.log("export fav:",t);let e={};for(let a=0;a<t.length;a++)e[t[a]]=localStorage.getItem(t[a]);let s="export_favorite_"+y.get_current_time_f()+".json";y.download_text_as_file(JSON.stringify(e),s)},async importFavClick(){function t(t){if("undefined"===typeof t)throw new Error("object is undefined")}this.menu_more_is_shown=!1;try{let e=await y.get_file_content(".json");e=JSON.parse(e),console.log(e);let s=Object.keys(e);console.log(s);for(let a=0;a<s.length;a++){let i=JSON.parse(e[s[a]]),o=Object.keys(i);for(let e=0;e<o.length;e++){let s=i[o[e]];t(s["al"]),t(s["name"]),t(s["h"]),t(s["w"]),t(s["ct"])}}for(let t=0;t<s.length;t++){let a=e[s[t]];console.log("Import favorite: ",s[t],a),window.localStorage.setItem(s[t],a)}this.initialize()}catch(e){console.log(e),alert(this.tr("content.fav.unrecognized"))}}}},ft=mt,wt=(s("4c9d"),Object(M["a"])(ft,G,J,!1,null,"1898d03a",null)),vt=wt.exports,bt=function(){var t=this,e=t._self._c;return e("div",{class:t.showNavBar?"preview-with-navbar":"preview-hidden-navbar",staticStyle:{width:"100%",height:"100%",position:"relative",overflow:"hidden"}},[e("div",{ref:"canvasContainer",staticClass:"canvas-container",on:{mousedown:t.handleMouseDown,mousemove:t.handleMouseMove,mouseup:t.handleMouseUp,mouseleave:t.handleMouseUp,wheel:t.handleWheel,click:t.handleCanvasClick,touchstart:t.handleTouchStart,touchmove:t.handleTouchMove,touchend:t.handleTouchEnd,touchcancel:t.handleTouchEnd}},[e("canvas",{ref:"canvas",attrs:{width:t.canvasWidth,height:t.canvasHeight}})]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.showNavBar,expression:"showNavBar"}],staticClass:"navbar",staticStyle:{width:"100% !important"}},[e("div",{staticClass:"nav-title"},[t._v(" "+t._s(t.photo_name)+" ")]),e("div",{staticClass:"left-button-group",on:{click:function(e){return t.raise_hide_preview()}}},[e("i",{staticClass:"larrow"}),e("span",{staticClass:"backtext"},[t._v(t._s(""===t.catalog_name?t.tr("Album"):t.catalog_name))])]),e("div",{staticClass:"right-button-group"},[e("a",{attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.downloadPhoto()}}},[t._v(t._s(t.tr("preview.download_btn")))])])]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.showNavBar,expression:"showNavBar"}],staticClass:"zoom-toolbar"},[e("div",{staticClass:"toolbar-group"},[e("button",{staticClass:"zoom-btn",attrs:{disabled:t.scale<=t.minScale,title:t.tr("preview.zoom_out")},on:{click:t.zoomOut}},[e("svg",{attrs:{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M5 12H19",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"}})])]),e("button",{staticClass:"zoom-btn zoom-percent-btn",attrs:{title:t.tr("preview.zoom_percent")},on:{click:t.toggleZoomPanel}},[e("span",{staticStyle:{"font-size":"12px"}},[t._v(t._s(Math.round(100*t.scale))+"%")])]),e("button",{staticClass:"zoom-btn",attrs:{disabled:t.scale>=t.maxScale,title:t.tr("preview.zoom_in")},on:{click:t.zoomIn}},[e("svg",{attrs:{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M12 5V19M5 12H19",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"}})])]),e("button",{staticClass:"zoom-btn",attrs:{disabled:t.scale===t.initialScale&&t.offsetX===t.initialOffsetX&&t.offsetY===t.initialOffsetY,title:t.tr("preview.reset_zoom")},on:{click:t.resetZoom}},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12Z",stroke:"currentColor","stroke-width":"2"}}),e("path",{attrs:{d:"M12 8L8 12L12 16",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M8 12H16",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"}})])])]),e("div",{staticClass:"toolbar-divider"}),e("div",{staticClass:"toolbar-group"},[e("button",{staticClass:"zoom-btn nav-photo-btn",attrs:{disabled:t.index<=0,title:t.tr("preview.prev_photo")},on:{click:t.showPreviousPhoto}},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M15 18L9 12L15 6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("span",{staticClass:"photo-counter"},[t._v(t._s(t.index+1)+" / "+t._s(t.photo_count||t.image_list.length))]),e("button",{staticClass:"zoom-btn nav-photo-btn",attrs:{disabled:t.index>=(t.photo_count||t.image_list.length)-1,title:t.tr("preview.next_photo")},on:{click:t.showNextPhoto}},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M9 18L15 12L9 6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])])]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.showZoomPanel&&t.showNavBar,expression:"showZoomPanel && showNavBar"}],ref:"zoomPanel",staticClass:"zoom-panel",style:{left:t.zoomPanelLeft+"px",top:t.zoomPanelTop+"px"}},[e("div",{staticClass:"zoom-panel-input-group"},[e("input",{staticClass:"zoom-slider",attrs:{type:"range",min:100*t.minScale,max:100*t.maxScale},domProps:{value:100*t.scale},on:{input:t.handleSliderChange}}),e("input",{staticClass:"zoom-percent-input",attrs:{type:"number",min:100*t.minScale,max:100*t.maxScale},domProps:{value:Math.round(100*t.scale)},on:{input:t.handlePercentInput,blur:t.handlePercentBlur}}),e("span",{staticClass:"zoom-percent-suffix"},[t._v("%")])])])])},Ct=[],St=(s("8f6b"),{name:"Preview",props:["current_album_name","current_photo_filename","image_list","index","catalog_name","current_photo","photo_count"],data(){return{showNavBar:!0,isLoading:!0,canvasWidth:0,canvasHeight:0,image:null,thumbnail:null,scale:1,minScale:.1,maxScale:5,offsetX:0,offsetY:0,isDragging:!1,dragStartX:0,dragStartY:0,dragStartOffsetX:0,dragStartOffsetY:0,dragEndX:void 0,dragEndY:void 0,initialScale:1,initialOffsetX:0,initialOffsetY:0,isDarkMode:!1,touches:[],lastTouchDistance:0,lastTouchCenter:{x:0,y:0},lastTouchScale:1,isPinching:!1,showZoomPanel:!1,zoomPanelLeft:0,zoomPanelTop:0}},computed:{photo_name(){return this.current_photo_filename.replace(/\.[a-z|A-Z|0-9]*$/g,"")},thumbnail_path(){return`/api/album-cache/${this.current_album_name}/${this.current_photo_filename}`},photo_path(){return`/api/album/${this.current_album_name}/${this.current_photo_filename}`},zoomPercent(){return Math.round(100*this.scale)}},methods:{tr(t,...e){return y.translate(t,...e)},raise_hide_preview(){this.$emit("hide-preview")},showPreviousPhoto(){if(this.index>0){const t=this.index-1,e=this.image_list[t];this.$emit("change-photo",e.name,this.image_list,t,e.al,e)}},showNextPhoto(){const t=(this.photo_count||this.image_list.length)-1;if(this.index<t){const t=this.index+1;if(t<this.image_list.length){const e=this.image_list[t];this.$emit("change-photo",e.name,this.image_list,t,e.al,e)}else this.$emit("load-more-photos",t)}},thumbnail_path_at_index(t){return`/api/album-cache/${this.image_list[t].al}/${this.image_list[t].name}`},photo_path_at_index(t){return`/api/album/${this.image_list[t].al}/${this.image_list[t].name}`},downloadPhoto(){window.open(this.photo_path)},updateCanvasSize(){if(this.$refs.canvasContainer){const t=this.$refs.canvasContainer.getBoundingClientRect();this.canvasWidth=t.width,this.canvasHeight=t.height}else this.canvasWidth=window.innerWidth,this.canvasHeight=window.innerHeight;this.$nextTick(()=>{this.drawImage()})},calculateInitialTransform(){if(!this.current_photo)return;const t=this.current_photo.w,e=this.current_photo.h,s=this.canvasWidth,a=this.canvasHeight,i=s/t,o=a/e;this.initialScale=Math.min(i,o,1),this.initialOffsetX=s/2,this.initialOffsetY=a/2,this.scale=this.initialScale,this.offsetX=this.initialOffsetX,this.offsetY=this.initialOffsetY},async loadImages(){this.isLoading=!0,this.updateCanvasSize();const t=new Image;t.crossOrigin="anonymous",t.onload=()=>{this.thumbnail=t,!this.image&&this.current_photo&&this.calculateInitialTransform(),this.drawImage()},t.onerror=()=>{console.error("Failed to load thumbnail:",this.thumbnail_path)},t.src=this.thumbnail_path;const e=new Image;e.crossOrigin="anonymous",e.onload=()=>{this.image=e,this.isLoading=!1,this.calculateInitialTransform(),this.drawImage()},e.onerror=()=>{this.isLoading=!1,console.error("Failed to load image:",this.photo_path),this.thumbnail&&this.drawImage()},e.src=this.photo_path},checkDarkMode(){const t=window.matchMedia("(prefers-color-scheme: dark)");return this.isDarkMode=t.matches,this.isDarkMode},drawImage(){const t=this.$refs.canvas;if(!t)return;const e=t.getContext("2d");if(e.clearRect(0,0,t.width,t.height),this.showNavBar?(this.checkDarkMode(),e.fillStyle=this.isDarkMode?"#000000":"#ffffff"):e.fillStyle="#000000",e.fillRect(0,0,t.width,t.height),!this.image&&!this.thumbnail)return;const s=this.image||this.thumbnail;if(!s||!this.current_photo)return;e.save(),e.translate(this.offsetX,this.offsetY),e.scale(this.scale,this.scale);const a=this.current_photo.w,i=this.current_photo.h;e.drawImage(s,-a/2,-i/2,a,i),e.restore()},zoomIn(){this.scale=Math.min(1.2*this.scale,this.maxScale),this.drawImage()},zoomOut(){this.scale=Math.max(this.scale/1.2,this.minScale),this.drawImage()},resetZoom(){this.scale=this.initialScale,this.offsetX=this.initialOffsetX,this.offsetY=this.initialOffsetY,this.drawImage()},handleWheel(t){t.preventDefault();const e=this.$refs.canvas;if(!e)return;const s=t.deltaY>0?.9:1.1,a=this.scale,i=Math.max(this.minScale,Math.min(this.scale*s,this.maxScale)),o=e.getBoundingClientRect(),n=t.clientX-o.left,r=t.clientY-o.top,l=i/a;this.offsetX=n-(n-this.offsetX)*l,this.offsetY=r-(r-this.offsetY)*l,this.scale=i,this.drawImage()},handleMouseDown(t){0===t.button&&(this.isDragging=!0,this.dragStartX=t.clientX,this.dragStartY=t.clientY,this.dragStartOffsetX=this.offsetX,this.dragStartOffsetY=this.offsetY,this.dragEndX=t.clientX,this.dragEndY=t.clientY,t.preventDefault())},handleMouseMove(t){if(this.isDragging){const e=t.clientX-this.dragStartX,s=t.clientY-this.dragStartY;this.offsetX=this.dragStartOffsetX+e,this.offsetY=this.dragStartOffsetY+s,this.drawImage(),t.preventDefault()}},handleMouseUp(t){this.isDragging&&(this.dragEndX=t.clientX,this.dragEndY=t.clientY),this.isDragging=!1},handleCanvasClick(t){if(void 0!==this.dragEndX&&void 0!==this.dragEndY){const t=Math.abs(this.dragStartX-this.dragEndX),e=Math.abs(this.dragStartY-this.dragEndY);t<5&&e<5&&(this.showNavBar=!this.showNavBar,this.$nextTick(()=>{this.drawImage()}))}this.dragEndX=void 0,this.dragEndY=void 0},getTouchDistance(t){if(t.length<2)return 0;const e=t[0].clientX-t[1].clientX,s=t[0].clientY-t[1].clientY;return Math.sqrt(e*e+s*s)},getTouchCenter(t){if(0===t.length)return{x:0,y:0};if(1===t.length){const e=this.$refs.canvas;if(!e)return{x:0,y:0};const s=e.getBoundingClientRect();return{x:t[0].clientX-s.left,y:t[0].clientY-s.top}}const e=this.$refs.canvas;if(!e)return{x:0,y:0};const s=e.getBoundingClientRect(),a=(t[0].clientX+t[1].clientX)/2-s.left,i=(t[0].clientY+t[1].clientY)/2-s.top;return{x:a,y:i}},handleTouchStart(t){if(t.preventDefault(),this.touches=Array.from(t.touches),1===this.touches.length){const t=this.touches[0];this.isDragging=!0,this.dragStartX=t.clientX,this.dragStartY=t.clientY,this.dragStartOffsetX=this.offsetX,this.dragStartOffsetY=this.offsetY,this.dragEndX=t.clientX,this.dragEndY=t.clientY,this.isPinching=!1}else 2===this.touches.length&&(this.isPinching=!0,this.isDragging=!1,this.lastTouchDistance=this.getTouchDistance(this.touches),this.lastTouchCenter=this.getTouchCenter(this.touches),this.lastTouchScale=this.scale)},handleTouchMove(t){if(t.preventDefault(),this.touches=Array.from(t.touches),1!==this.touches.length||this.isPinching){if(2===this.touches.length){this.isPinching=!0,this.isDragging=!1;const t=this.getTouchDistance(this.touches),e=this.getTouchCenter(this.touches);if(this.lastTouchDistance>0&&this.lastTouchScale>0){const s=t/this.lastTouchDistance,a=Math.max(this.minScale,Math.min(this.lastTouchScale*s,this.maxScale)),i=(this.lastTouchScale,e.x,this.lastTouchCenter.x,e.y,this.lastTouchCenter.y,(this.lastTouchCenter.x-this.offsetX)/this.lastTouchScale),o=(this.lastTouchCenter.y-this.offsetY)/this.lastTouchScale;this.offsetX=e.x-i*a,this.offsetY=e.y-o*a,this.scale=a,this.drawImage()}this.lastTouchDistance=t,this.lastTouchCenter=e,this.lastTouchScale=this.scale}}else if(this.isDragging){const t=this.touches[0],e=t.clientX-this.dragStartX,s=t.clientY-this.dragStartY;this.offsetX=this.dragStartOffsetX+e,this.offsetY=this.dragStartOffsetY+s,this.dragEndX=t.clientX,this.dragEndY=t.clientY,this.drawImage()}},handleTouchEnd(t){if(t.preventDefault(),1===this.touches.length&&!this.isPinching&&this.isDragging){const t=this.touches[0];this.dragEndX=t.clientX,this.dragEndY=t.clientY;const e=Math.abs(this.dragStartX-this.dragEndX),s=Math.abs(this.dragStartY-this.dragEndY);e<5&&s<5&&(this.showNavBar=!this.showNavBar,this.$nextTick(()=>{this.drawImage()}))}if(this.touches=Array.from(t.touches),0===this.touches.length)this.isDragging=!1,this.isPinching=!1,this.lastTouchDistance=0,this.lastTouchCenter={x:0,y:0},this.dragEndX=void 0,this.dragEndY=void 0;else if(1===this.touches.length){this.isPinching=!1;const t=this.touches[0];this.isDragging=!0,this.dragStartX=t.clientX,this.dragStartY=t.clientY,this.dragStartOffsetX=this.offsetX,this.dragStartOffsetY=this.offsetY,this.dragEndX=t.clientX,this.dragEndY=t.clientY}},toggleZoomPanel(){this.showZoomPanel=!this.showZoomPanel,this.showZoomPanel&&this.$nextTick(()=>{const t=document.querySelector(".zoom-toolbar"),e=this.$refs.zoomPanel;if(t&&e){const s=t.getBoundingClientRect(),a=e.getBoundingClientRect();this.zoomPanelLeft=s.left+(s.width-a.width)/2,this.zoomPanelTop=s.top-a.height-10}})},handleSliderChange(t){const e=parseFloat(t.target.value)/100,s=this.$refs.canvas;if(!s)return;const a=s.width/2,i=s.height/2,o=this.scale,n=e/o;this.offsetX=a-(a-this.offsetX)*n,this.offsetY=i-(i-this.offsetY)*n,this.scale=Math.max(this.minScale,Math.min(e,this.maxScale)),this.drawImage()},handlePercentInput(t){},handlePercentBlur(t){const e=parseFloat(t.target.value);if(isNaN(e))return void(t.target.value=Math.round(100*this.scale));const s=Math.max(100*this.minScale,Math.min(e,100*this.maxScale)),a=s/100,i=this.$refs.canvas;if(!i)return;const o=i.width/2,n=i.height/2,r=this.scale,l=a/r;this.offsetX=o-(o-this.offsetX)*l,this.offsetY=n-(n-this.offsetY)*l,this.scale=a,this.drawImage(),t.target.value=Math.round(100*this.scale)}},watch:{current_photo(t,e){t&&t!==e&&(this.scale=1,this.offsetX=0,this.offsetY=0,this.image=null,this.thumbnail=null,this.loadImages())},showNavBar(t){t||(this.showZoomPanel=!1),this.$nextTick(()=>{this.drawImage()})}},mounted(){this.$nextTick(()=>{this.updateCanvasSize(),window.addEventListener("resize",this.updateCanvasSize);const t=window.matchMedia("(prefers-color-scheme: dark)"),e=t=>{this.isDarkMode=t.matches,this.drawImage()};t.addEventListener("change",e),this.darkModeMediaQuery=t,this.handleThemeChange=e,this.current_photo&&this.loadImages()})},beforeDestroy(){window.removeEventListener("resize",this.updateCanvasSize),this.darkModeMediaQuery&&this.handleThemeChange&&this.darkModeMediaQuery.removeEventListener("change",this.handleThemeChange)}}),yt=St,xt=(s("6063"),Object(M["a"])(yt,bt,Ct,!1,null,"0949eb4a",null)),kt=xt.exports,Lt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"pwdi"},[e("div",{staticStyle:{position:"relative",height:"100%",width:"100%",margin:"0 0"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:!0,expression:"true || password_dialog_shown"}],staticClass:"dialog"},[e("div",{staticClass:"title"},[t._v(" "+t._s(t.tr("pwdi.title"))+" ")]),e("div",{staticClass:"ctnt"},[t.passwordErrorMsgShown?e("p",{staticStyle:{color:"red"}},[t._v(t._s(t.tr("pwdi.retry")))]):e("p",[t._v(t._s(t.tr("pwdi.hint")))]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.passwordEntered,expression:"passwordEntered"}],ref:"pi",attrs:{type:"password",placeholder:t.tr("Password")},domProps:{value:t.passwordEntered},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submitPassword()},input:function(e){e.target.composing||(t.passwordEntered=e.target.value)}}}),e("div",{staticStyle:{"padding-top":"25px","text-align":"center"}},[e("button",{staticClass:"primary",staticStyle:{width:"100px"},attrs:{disabled:!t.password_dialog_shown},on:{click:function(e){return t.submitPassword()}}},[t._v(t._s(t.tr("OK")))])])])])])])},Pt=[];s("a9fa");let Mt=s("30d7");var It={name:"PasswordInput",data:()=>({passwordErrorMsgShown:!1,passwordEntered:"",password_dialog_shown:!0,showInput:!0}),methods:{tr(t,...e){return y.translate(t,...e)},async submitPassword(){if(this.password_dialog_shown){if(console.log("submit password: ",Mt(this.passwordEntered)),""===this.passwordEntered)return this.$refs.pi.focus();this.password_dialog_shown=!1,this.$emit("submit-password",Mt(this.passwordEntered))}},feedback(t){t||(this.password_dialog_shown=!0,this.passwordEntered="",this.passwordErrorMsgShown=!0)}},watch:{password_dialog_shown(){}},mounted(){this.$refs.pi.focus()}},zt=It,Tt=Object(M["a"])(zt,Lt,Pt,!1,null,"a95f5d60",null),Nt=Tt.exports,Et=function(){var t=this,e=t._self._c;return e("div",{staticClass:"popd",on:{click:function(e){return e.target!==e.currentTarget?null:t.closeSettings.apply(null,arguments)}}},[e("div",{staticClass:"dialog",staticStyle:{"max-width":"500px","max-height":"80vh","overflow-y":"auto"}},[e("div",{staticClass:"title"},[t._v(" "+t._s(t.tr("Settings"))+" ")]),e("div",{staticClass:"ctnt",staticStyle:{"text-align":"left"}},[e("div",{staticClass:"settings-section"},[e("h3",[t._v(t._s(t.tr("General")))]),e("div",{staticClass:"settings-item"},[e("label",[t._v(t._s(t.tr("Language")))]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedLanguage,expression:"selectedLanguage"}],on:{change:[function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.selectedLanguage=e.target.multiple?s:s[0]},t.onLanguageChange]}},[e("option",{attrs:{value:"zh-CN"}},[t._v("中文")]),e("option",{attrs:{value:"en-US"}},[t._v("English")])]),e("p",{staticClass:"settings-hint"},[t._v(t._s(t.tr("settings.language_hint")))])])]),e("div",{staticClass:"settings-section"},[e("h3",[t._v(t._s(t.tr("About")))]),e("div",{staticClass:"settings-item"},[e("p",[t._v("Beautiful Album")]),t._m(0),e("p",{staticStyle:{"margin-top":"10px",color:"#888","font-size":"12px"}},[t._v(t._s(t.tr("settings.license")))])])])]),e("div",{staticClass:"cbgroup",staticStyle:{"padding-top":"3px","text-align":"right","padding-right":"10px"}},[e("button",{staticClass:"complete",on:{click:t.closeSettings}},[t._v(t._s(t.tr("Close")))])])])])},jt=[function(){var t=this,e=t._self._c;return e("p",{staticStyle:{"margin-top":"10px"}},[e("a",{staticClass:"github-link",attrs:{href:"https://github.com/acane77/BeautifulAlbum",target:"_blank"}},[t._v("GitHub Repository")])])}];function Yt(){let t=navigator.language;if(window.localStorage){let e=window.localStorage.getItem("language");"undefined"!==typeof e&&null!=e&&e.length&&(t=e)}return t.startsWith("en")?"en-US":t}var $t={name:"Settings",data:()=>({selectedLanguage:"zh-CN"}),methods:{tr(t,...e){return y.translate(t,...e)},closeSettings(){this.$emit("close-settings")},onLanguageChange(){window.localStorage&&window.localStorage.setItem("language",this.selectedLanguage),location.reload()}},mounted(){this.selectedLanguage=Yt()}},Xt=$t,Ot=(s("acd9"),Object(M["a"])(Xt,Et,jt,!1,null,"2a993242",null)),Bt=Ot.exports;s("30d7");var Dt={name:"App",components:{Sidebar:q,ContentView:vt,Preview:kt,PasswordInput:Nt,Settings:Bt},data:()=>({activeName:"beautiful-album",content_view_shown:!0,sidebar_shown_on_mobile_mode:!1,sidebar_shown_on_pc_mode:!0,password_input_shown:!1,settings_shown:!1,preview_shown:!1,preview_filename:"",preview_imagelist:[],preview_index:0,preview_album_name:"",preview_current_obj:"",preview_photo_count:0,contentAlbumName:"",contentFriendlyName:"",people_enabled:!1}),methods:{tr(t,...e){return y.translate(t,...e)},previewPhoto(t,e,s,a,i,o){this.preview_filename=t,this.preview_index=s,this.preview_imagelist=e,this.preview_album_name=a,this.preview_current_obj=i,this.preview_photo_count=o||e.length,this.preview_shown=!0},async loadMorePhotos(t){this.$refs.contentView&&(await this.$refs.contentView.load_image(),this.$nextTick(()=>{const e=this.$refs.contentView.photo_list;if(void 0!==t&&e&&t<e.length){const s=e[t];this.previewPhoto(s.name,e,t,s.al,s,this.preview_photo_count)}}))},async requirePassword(){this.password_input_shown=!0},async checkPassword(t){if(window.is_share_link){let s=y.md5_transform(window.share_id,t);console.log("share id:  ",window.share_id),console.log("password:  ",t),console.log("album_hash:",s);try{await y.get_json(`shared/${s}-get-photo-count`),this.$refs.password_input.feedback(!0),this.password_input_shown=!1,this.initialize_for_share(s)}catch(e){this.requirePassword(),this.$refs.password_input.feedback(!1)}}else{window.miyuki_password=t,window.enabled_password=!0;try{await y.get_secured_json("get-album"),localStorage.setItem("password",t),this.$refs.password_input.feedback(!0),this.password_input_shown=!1,this.initialize()}catch(e){localStorage.removeItem("password"),this.requirePassword(),this.$refs.password_input.feedback(!1)}}},initialize(){this.$refs.sidebar.getAlbumList(),this.contentAlbumName="/all",this.contentFriendlyName=this.tr("sidebar.photo_library")},initialize_for_share(t){this.$refs.sidebar.getAlbumListForShare(t),this.contentAlbumName="/share",this.contentFriendlyName=this.tr("sidebar.shared_album")}},async mounted(){let t;function e(){let t={},e=location.href.split("?")[1];return"undefined"==typeof e||e.split("&").forEach((function(e){var s=e.split("=");t[s[0]]=s[1]})),t}window.innerWidth<=500&&(this.sidebar_shown_on_mobile_mode=!0);let s=e();if(window.is_share_link="undefined"!==typeof s["shared_id"],window.share_id=String(s["shared_id"]).padEnd(32,"0"),t=window.is_share_link,window.is_share_link&&localStorage.removeItem("password"),!window.is_share_link){const e=await y.get_json("password");t=e.enabled,this.people_enabled=e.people_enabled}t?null!==localStorage.getItem("password")?this.checkPassword(localStorage.getItem("password")):this.requirePassword():(window.enabled_password=!1,this.initialize())}},Ft=Dt,At=(s("0e4f"),Object(M["a"])(Ft,i,o,!1,null,null,null)),Zt=At.exports;a["a"].config.productionTip=!1,function(){document.addEventListener("gesturestart",(function(t){t.preventDefault()})),document.addEventListener("gesturechange",(function(t){t.preventDefault()})),document.addEventListener("gestureend",(function(t){t.preventDefault()})),document.addEventListener("wheel",(function(t){(t.ctrlKey||t.metaKey)&&t.preventDefault()}),{passive:!1}),document.addEventListener("keydown",(function(t){!t.ctrlKey&&!t.metaKey||"+"!==t.key&&"-"!==t.key&&"="!==t.key&&"0"!==t.key||t.preventDefault()})),document.addEventListener("touchstart",(function(t){t.touches.length>1&&t.preventDefault()}),{passive:!1}),document.addEventListener("touchmove",(function(t){t.touches.length>1&&t.preventDefault()}),{passive:!1})}(),new a["a"]({render:t=>t(Zt)}).$mount("#app")},6063:function(t,e,s){"use strict";s("b28d")},6941:function(t,e,s){},"6c84":function(t,e,s){},"7f5e":function(t,e,s){},"8e0f":function(t,e,s){},"8e9e":function(t,e,s){},"8f6b":function(t,e,s){},"9b91":function(t,e,s){},a9fa:function(t,e,s){},acd9:function(t,e,s){"use strict";s("d5b0")},b28d:function(t,e,s){},b767:function(t,e,s){},b979:function(t,e,s){"use strict";s("8e0f")},bfe0:function(t,e,s){},c112:function(t,e,s){},d5b0:function(t,e,s){},eacf:function(t,e,s){},f33e:function(t,e,s){}});
//# sourceMappingURL=app.33fac387.js.map